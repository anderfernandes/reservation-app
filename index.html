<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>New Reservation App</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.22/vue.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.5.2/flatpickr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-flatpickr-component@8.1.1/dist/vue-flatpickr.min.js"></script>
  <script src="https://unpkg.com/semantic-ui-vue/dist/umd/semantic-ui-vue.min.js"></script>


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.7.2/dist/semantic.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.5.2/flatpickr.min.css">

  <link rel="stylesheet" href="styles.css">

</head>
<body>
  <div id="app" style="margin:1rem 1rem 1rem 1rem">
    <transition name="fade" mode="out-in">
      <div class="ui container" v-if="!isSuccess">
        <div class="ui dividing header">
          <i class="bus icon"></i>
          <div class="content">
            Field Trip Reservation App
            <div class="sub header">Design and schedule your field trip in minutes!</div>
          </div>
        </div>
        <div class="ui three column grid">
          <div class="column">
            <div class="ui segment">
              <img src="https://www.acpce.org/wp-content/uploads/2015/10/college-student-icon.png"
                   class="ui centered small image">
              <div class="ui header">
                How many students?
                <div class="sub header">
                  We require a <strong>minimum of paying 20 tickets</strong> to book a field trip.
                </div>
              </div>
              <div class="ui huge centered header">{{ attendance.students }}</div>
              <input type="range" min="0" max="180" v-model="attendance.students">
              <sui-label pointing basic>
                Slide left or right to change numbers
              </sui-label>
            </div>
          </div>
          <div class="column">
            <div class="ui segment">
              <img src="https://dumielauxepices.net/sites/default/files/drawn-people-icon-561069-9221277.svg"
                   class="ui centered small image">
              <div class="ui header">
                How many teachers?
                <div class="sub header">
                  Chaperones and bus drivers also go here. For every 10 students, one teacher is free.
                </div>
              </div>
              <div class="ui huge centered header">{{ attendance.teachers }}</div>
              <input type="range" min="0" max="30" v-model="attendance.teachers">
              <sui-label pointing basic>
                Slide left or right to change numbers
              </sui-label>
            </div>
          </div>
          <div class="column">
            <div class="ui segment">
              <img src="https://image.flaticon.com/icons/svg/437/437532.svg" alt="" class="ui centered small image">
              <div class="ui header">
                How many parents?
                <div class="sub header">
                  Include parents in the count below
                  <strong>only if they are not paying for their own tickets</strong>.
                </div>
              </div>
              <div class="ui huge centered header">{{ attendance.parents }}</div>
              <input type="range" min="0" max="60" v-model="attendance.parents">
              <sui-label pointing basic>
                Slide left or right to change numbers
              </sui-label>
            </div>
          </div>
        </div>
        <!--- Error Messages -->
        <transition name="fade" mode="out-in">
          <div class="ui one column grid"
               v-if="(totalAttendance > 180) ||
                     ((attendance.teachers / attendance.students) > 0.1) ||
                     attendance.students < 20 ||
                     attendance.parents > 0">
            <div class="column">
              <div class="ui info icon message" v-if="attendance.parents > 0">
                <i class="info circle icon"></i>
                <div class="content">
                  <div class="header">
                    About parent tickets
                  </div>
                  <p>Do not include parents in the count if they are paying for their own tickets.</p>
                </div>
              </div>
              <div class="ui warning icon message" v-if="totalAttendance > 180">
                <i class="info circle icon"></i>
                <div class="content">
                  <div class="header">
                    We can't seat {{ totalAttendance }}!
                  </div>
                  <p>We can only seat {{ attendance.capacity }} people in our theater.
                     Please take {{ totalAttendance - attendance.capacity }}
                     {{ (totalAttendance - attendance.capacity) == 1 ? "person" : "people" }}
                     out of the reservation in order to proceed.
                   </p>
                </div>
              </div>
              <div class="ui info icon message"
                   v-if="((attendance.teachers / attendance.students) > 0.1)">
                <i class="info circle icon"></i>
                <div class="content">
                  <div class="header">
                    About free teacher tickets
                  </div>
                  <p>Teachers are free if you keep the teacher/student ratio under 10.
                    The {{ (attendance.teachers - Math.floor((attendance.students / 10))) }} extra
                    {{ (attendance.teachers - (Math.floor(attendance.students / 10))) == 1 ? "teacher" : "teachers" }}
                    you have may be charged.
                  </p>
                </div>
              </div>
              <div class="ui warning icon message" v-if="attendance.students < 20">
                <i class="info circle icon"></i>
                <div class="content">
                  <div class="header">
                    You need {{ 20 - attendance.students }} more
                    {{ (20 - attendance.students) == 1 ? "student" : "students" }}
                    to put in a reservation!
                  </div>
                  <p>
                    We require a minimum of 20 paying tickets to reserve a show. If you don't meet
                    that requirement, you can attend one of our <a href="http://starsatnight.org">Public Shows</a>
                    without a reservation. If that doesn't work for you, put 20 in the amount of kids, pay for the
                    20 tickets and you will be able to reserve your own show.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </transition>
        <!-- Amount of Events -->
        <transition name="fade" mode="out-in">
          <div class="ui basic segment" v-if="(totalAttendance <= 180) && (attendance.teachers > 0)">
            <div class="ui two cards">
              <div class="card" @click="highlightCard(1)" :class="event.shows == 1 ? 'selected' : ''">
                <div class="content">
                  <div class="center aligned header">
                    One Show
                  </div>
                  <div class="center aligned description">
                    1 Full Dome or Laser Light +
                    1 Startalk or Uniview +
                    1 SpacePark360 Virtual Roller Coaster (time permitting)
                  </div>
                </div>
              </div>
              <div class="card" @click="highlightCard(2)" :class="event.shows == 2 ? 'selected' : ''">
                <div class="content">
                  <div class="center aligned header">
                    Two Shows
                    <div class="ui top right attached green label">
                      <i class="thumbs up icon"></i>
                      Best Value!
                    </div>
                    <br />
                  </div>
                  <div class="center aligned description">
                    2 Full Dome or Laser Light (or 1 of each) +
                    1 Startalk or Uniview +
                    1 SpacePark360 Virtual Roller Coaster (time permitting)
                  </div>
                </div>
              </div>
            </div>
          </div>
        </transition>
        <!-- Query events -->
        <transition name="fade" mode="out-in">
          <div class="ui grid" v-if="event.shows != null">
            <div class="ui five wide column">
              <flatpickr placeholder="Click here and select a date"
                         v-model="event.date"
                         :config="config"
                         @input="queryEvents">
            </div>
            <div class="ui eleven wide column">
              <div class="ui dividing centered header">
                <i class="calendar alternate icon"></i>
                <div class="content">
                  {{ event.date == null ? "Select a date" : event.date }}
                </div>
              </div>
              <!-- Loader Spinning Wheel -->
              <div v-if="isLoadingEvents" class="ui basic segment">
                <br /><br />
                <div class="ui active inverted dimmer">
                  <div class="ui text loader">Loading Events...</div>
                  <br /><br />
                </div>
              </div>
              <!-- Show alert to chose date -->
              <div class="ui warning icon message" v-else-if="this.filteredEvents == 0">
                <i class="info circle icon"></i>
                <div class="content">
                  <div class="header">
                    Select a date!
                  </div>
                  <p>Please select a date from the calendar.
                   </p>
                </div>
              </div>
              <!-- Show alert to chose date -->
              <div class="ui error icon message" v-else-if="this.fetchFailed">
                <i class="warning circle icon"></i>
                <div class="content">
                  <div class="header">
                    Error!
                  </div>
                  <p>
                    We are having problems fetchig events from the calendar.
                    Please try again in a few minutes.
                  </p>
                </div>
              </div>
              <!-- Show events -->
              <div class="ui inverted segment"
                   :class="event.title == 'Available' ? 'blue' : 'red'"
                   v-for="event in filteredEvents"
                   v-else>
                <div class="ui small inverted header">
                  <i class="calendar alternate icon"></i>
                  <div class="content">
                    {{ event.title }}
                    <div class="sub header">
                      {{ moment(event.start).format("hh:mm A") }} - {{ moment(event.end).format("hh:mm A") }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </transition>
        <!-- First Show -->
        <transition name="fade" mode="out-in">
          <div class="ui one column grid" v-if="(event.shows > 0) && (event.date != null)">
            <div class="column">
              <div class="ui dividing header">
                {{ event.shows == 1 ? "Show Information" : "First Show" }}
                <div class="sub header">
                  Select a time and a show from the dropdown. Feel free to change the show to see what it is about.
                </div>
              </div>
              <div class="ui segment">
                <div class="ui warning icon message"
                    v-if="(event.firstShowTime == event.secondShowTime) && (event.firstShowTime != null) && (event.firstShowTime != null)">
                  <i class="info circle icon"></i>
                  <div class="content">
                    <div class="header">
                      You can't watch another show at the same time..
                    </div>
                    <p>We only have one theater. Please select a different time.</p>
                  </div>
                </div>
                <div class="ui form">
                  <div class="two fields">
                    <div class="field">
                      <sui-dropdown selection
                                    fluid placeholder="Select a time"
                                    :options="showTimeOptions"
                                    v-model="event.firstShowTime">
                      </sui-dropdown>
                    </div>
                    <div class="field">
                      <sui-dropdown selection search
                                    fluid placeholder="Select a show"
                                    :options="filteredShows"
                                    v-model="event.firstShow">
                      </sui-dropdown>
                    </div>
                  </div>
                </div>
                <div class="ui warning icon message" v-if="(event.firstShow == event.secondShow) && (event.firstShow != null) && (event.firstShow != null)">
                  <i class="info circle icon"></i>
                  <div class="content">
                    <div class="header">
                      Watching the same show twice is boring...
                    </div>
                    <p>Try selecting different shows. There are  a total of {{ shows.length }} shows available.</p>
                  </div>
                </div>

                <!-- First Show Information -->
                <transition name="fade" mode="out-in">
                  <div class="ui items" v-if="event.firstShow != null">
                    <div class="item">
                      <div class="image">
                        <img :src="event.firstShow.cover" class="ui centered image">
                      </div>
                      <div class="content">
                        <div class="header">{{ event.firstShow.name }}</div>
                        <div class="meta">
                          <div class="ui black label">{{ event.firstShow.type }}</div>
                          <div class="ui black label">{{ event.firstShow.duration }} minutes</div>
                        </div>
                        <div class="extra">
                          <i class="calendar alternate icon"></i>
                          {{ event.date }} @
                          {{ moment(event.firstShowTime, dateFormat.long).format("hh:mm A") }}
                        </div>
                        <div class="description">
                          <p>{{ event.firstShow.description }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </transition>
              </div>
            </div>
          </div>
        </transition>
        <!-- Second Show -->
        <transition name="fade" mode="out-in">
          <div class="ui one column grid" v-if="(event.date != null) && (event.shows == 2)">
            <div class="column">
              <div class="ui dividing header">
                Second Show
                <div class="sub header">
                  Select a time and a show from the dropdown. Feel free to change the show to see what it is about.
                </div>
              </div>
              <div class="ui segment">
                <div class="ui warning icon message"
                     v-if="(event.firstShowTime == event.secondShowTime) && (event.secondShowTime != null) && (event.secondShowTime != null)">
                  <i class="info circle icon"></i>
                  <div class="content">
                    <div class="header">
                      You can't watch another show at the same time..
                    </div>
                    <p>We only have one theater. Please select a different time.</p>
                  </div>
                </div>
                <div class="ui form">
                  <div class="two fields">
                    <div class="field">
                      <sui-dropdown selection search
                                    fluid placeholder="Select a time"
                                    :options="showTimeOptions"
                                    v-model="event.secondShowTime">
                      </sui-dropdown>
                    </div>
                    <div class="field">
                      <sui-dropdown selection search
                                    fluid placeholder="Select a show"
                                    :options="filteredShows"
                                    v-model="event.secondShow">
                      </sui-dropdown>
                    </div>
                  </div>
                </div>
                <div class="ui warning icon message"
                     v-if="(event.firstShow == event.secondShow) && (event.secondShow != null)">
                  <i class="info circle icon"></i>
                  <div class="content">
                    <div class="header">
                      Watching the same show twice is boring...
                    </div>
                    <p>Try selecting a different shows. There are a total of {{ shows.length }} available.</p>
                  </div>
                </div>
                <!-- Second Show Info -->
                <transition name="fade" mode="out-in">
                  <div class="ui items" v-if="event.secondShow != null">
                    <div class="item">
                      <div class="image">
                        <img :src="event.secondShow.cover" class="ui centered image">
                      </div>
                      <div class="content">
                        <div class="header">{{ event.secondShow.name }}</div>
                        <div class="meta">
                          <div class="ui black label">{{ event.secondShow.type }}</div>
                          <div class="ui black label">{{ event.secondShow.duration }} minutes</div>
                        </div>
                        <div class="extra">
                          <i class="calendar alternate icon"></i>
                          {{ event.date }} @
                          {{ moment(event.secondShowTime, dateFormat.long).format("hh:mm A") }}
                        </div>
                        <div class="description">
                          <p>{{ event.secondShow.description }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </transition>
              </div>
            </div>
          </div>
        </transition>
        <!-- Post Show -->
        <transition name="fade" mode="out-in">
          <div class="ui one column grid" v-if="event.shows > 0 && event.firstShowTime != null && event.firstShow != null">
            <div class="column">
              <div class="ui dividing header">
                Post Show
                <div class="sub header">
                  This is the post show presentation. We use Uniview to flight
                  around the planets and galaxies in our Dome. In a Startalk we
                  will show you the constelations and planets of the current evening sky.
                </div>
              </div>
              <div class="segment">
                <sui-dropdown selection fluid
                              placeholder="Select a post show presentation"
                              :options="[{text: 'Startalk', value: 'Startalk'}, {text: 'Uniview', value: 'Uniview'}]"
                              v-model="event.postShow">
                </sui-dropdown>
              </div>
            </div>
          </div>
        </transition>
        <!-- Teacher and School Info -->
        <transition name="fade" mode="out-in">
          <div class="ui one column grid" v-if="event.postShow">
            <div class="column">
              <div class="ui success icon message">
                <i class="thumbs up icon"></i>
                <div class="content">
                  <div class="header">Out of this world!!!</div>
                  <p>Now we only need teacher and school information and your reservation will be on its way!</p>
                </div>
              </div>
            </div>
          </div>
        </transition>
        <transition name="fade" mode="out-in">
          <div class="ui one column grid">
            <div class="column">
              <div class="ui form" v-if="event.postShow">
                <div class="ui dividing header">
                  Group Leader Information
                  <div class="sub header">
                    Please enter your info.
                  </div>
                </div>
                <div class="two fields">
                  <div class="field">
                    <label for="First Name">First Name</label>
                    <input type="text" v-model="teacher.firstname" placeholder="Teacher's First Name">
                  </div>
                  <div class="field">
                    <label for="Last Name">Last Name</label>
                    <input type="text" v-model="teacher.lastname" placeholder="Teacher's Last Name">
                  </div>
                </div>
                <div class="two fields">
                  <div class="field">
                    <label for="First Name">Email</label>
                    <input type="email" v-model="teacher.email" placeholder="Teacher's Email">
                  </div>
                  <div class="field">
                    <label for="Last Name">Phone</label>
                    <div class="three fields">
                      <div class="field">
                        <div class="ui right labeled input">
                          <div class="ui label">(</div>
                          <input type="text"
                                 maxlength="3"
                                 size="3"
                                 placeholder="Area Code"
                                 v-model="teacher.phone[0]">
                          <div class="ui label">)</div>
                        </div>
                      </div>
                      <div class="field">
                        <input type="text" maxlength="3" size="3" placeholder="###"
                               v-model="teacher.phone[1]">
                      </div>
                      <div class="field">
                        <input type="text" maxlength="4" size="4" placeholder="####"
                               v-model="teacher.phone[2]">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="ui dividing header">
                  School Information
                  <div class="sub header">
                    Great job so far{{ (teacher.firstname == null) || (teacher.firstname == "") ? "" : ", " + teacher.firstname }}!
                    Please enter your school's info.
                  </div>
                </div>
                <div class="field">
                  <label for="school.name">School</label>
                  <sui-dropdown search selection fluid
                                placeholder="Select or start typing the name of your school. Do not abbreviate."
                                :options="filteredOrganizations"
                                v-model="school.id">
                  </sui-dropdown>
                </div>
                <!-- School Data if not in database -->
                <transition name="fade" mode="out-in">
                  <div id="school-data" v-if="school.id == 0">
                    <div class="ui info icon message">
                      <i class="thumbs up icon"></i>
                      <div class="content">
                        <div class="header">No problem!</div>
                        <p>Please fill the fields below. Do no abbreviate the name of the school.</p>
                      </div>
                    </div>
                    <div class="field">
                      <label for="school.name">School Name</label>
                      <input type="text" v-model="school.name" placeholder="School Name">
                    </div>
                    <div class="field">
                      <label for="school.address">Address</label>
                      <input type="text" v-model="school.address" placeholder="School Address">
                    </div>
                    <div class="two fields">
                      <div class="field">
                        <label for="city">City</label>
                        <input type="text" v-model="school.city" placeholder="City">
                      </div>
                      <div class="field">
                        <label for="state">State</label>
                        <sui-dropdown selection search
                                      fluid placeholder="Select a show"
                                      :options="[{text: 'Texas', value: 'Texas'}]"
                                      v-model="school.state">
                        </sui-dropdown>
                      </div>
                    </div>
                    <div class="two fields">
                      <div class="field">
                        <label for="ZIP">ZIP</label>
                        <input type="text" maxlength="5" v-model="school.zip" placeholder="ZIP">
                      </div>
                      <div class="field">
                        <label for="phone">Phone</label>
                        <div class="three fields">
                          <div class="field">
                            <div class="ui right labeled input">
                              <div class="ui label">(</div>
                              <input type="text"
                                     maxlength="3"
                                     size="3"
                                     placeholder="Area Code"
                                     v-model="school.phone[0]">
                              <div class="ui label">)</div>
                            </div>
                          </div>
                          <div class="field">
                            <input type="text" maxlength="3" size="3" placeholder="###"
                                   v-model="school.phone[1]">
                          </div>
                          <div class="field">
                            <input type="text" maxlength="4" size="4" placeholder="####"
                                   v-model="school.phone[2]">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </transition>
                <div class="field">
                  <label>Does your group have special needs?</label>
                  <sui-form-field>
                    <sui-checkbox
                      label="Yes"
                      radio
                      value="1"
                      v-model="school.specialNeeds"
                    />
                  </sui-form-field>
                  <sui-form-field>
                    <sui-checkbox
                      label="No"
                      radio
                      value="0"
                      v-model="school.specialNeeds"
                    />
                  </sui-form-field>
                </div>
                <div class="field">
                  <label>Does your school have a tax exempt form?</label>
                  <sui-form-field>
                    <sui-form-field>
                      <sui-checkbox
                        label="Yes"
                        radio
                        value="false"
                        v-model="school.taxable"
                      />
                    </sui-form-field>
                    <sui-form-field>
                      <sui-checkbox
                        label="No"
                        radio
                        value="true"
                        v-model="school.taxable"
                      />
                    </sui-form-field>
                  </sui-form-field>
                </div>
                <div class="field">
                  <label for="memo"></label>
                  <textarea 
                    name="memo" 
                    v-model="memo" 
                    v-if="school.specialNeeds == true" 
                    placeholder="Explain special needs or enter any special requests or comments about your reservation."></textarea>
                  <textarea 
                    name="memo" 
                    v-model="memo" 
                    v-else 
                    placeholder="Enter any special requests or comments about your reservation."></textarea>
                </div>
                <transition name="fade" mode="out-in">
                  <div class="field" v-if="!isFormValid">
                    <div class="ui negative icon message">
                      <i class="info circle icon"></i>
                      <div class="content">
                        <div class="header">
                          Oops!
                        </div>
                        <p>Please fix the following:</p>
                        <ul>
                          <li v-if="!teacher.firstname">
                            We need your first name
                          </li>
                          <li v-if="!teacher.lastname">
                            We need your last name
                          </li>
                          <li v-if="!teacher.email">
                            We need your email
                          </li>
                          <li v-if="!teacher.phone[0] || !teacher.phone[1] || !teacher.phone[2]">
                            We need a phone number 
                          </li>
                          <li v-if="!isSchoolValid && !school.name">
                            Please enter the name of the school, do not abbreviate
                          </li>
                          <li v-if="!isSchoolValid && !school.address">
                              Please enter the address of the school
                          </li>
                          <li v-if="!isSchoolValid && !school.city">
                              Please enter the city of the school
                          </li>
                          <li v-if="!isSchoolValid && !school.zip">
                              Please enter the ZIP of the school
                          </li>
                          <li v-if="!isSchoolValid && (!school.phone[0] || !school.phone[1] || !school.phone[2])">
                              Please enter the phone number of the school
                          </li>
                          <li v-if="!this.school.specialNeeds">
                            Let us know if your group as kids with special needs
                          </li>
                          <li v-if="!school.taxable">
                            Let us know if your school has a tax exempt form
                          </li>
                          <li v-if="this.school.id != 0">
                            If your school is not on the list of schools, please select the option "My school is not on this list"
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </transition>
                <div class="field">
                  <button :class="isFormValid ? 'ui green button' : 'ui green disabled button'"
                          @click="submit">
                    <i class="check icon"></i>
                    Submit
                  </button>
                  <button class="ui yellow button" onclick="window.location.reload()">
                    <i class="eraser icon"></i>
                    Start Over
                  </button>
                </div>
              </div>
            </div>
          </div>
        </transition>
      </div>
    </transition>
    <transition name="fade" mode="out-in">
      <div v-if="isSuccess">
        <div class="ui success icon message">
          <i class="thumbs up icon"></i>
          <div class="content">
            <div class="header">
              We've got your reservation, {{ teacher.firstname }}!
            </div>
            <p>
              Look out for a confirmation letter on the inbox of your email {{ teacher.email }}
              <strong>
                {{ moment().format("dddd") == "Friday"
                  ? "by " + moment().format("dddd, MMMM D, YYYY") + "."
                  : "in the next 24 hours."
                }}
              </strong>
            </p>
          </div>
        </div>
      </div>
    </transition>
  </div>
  <script src="app.js"></script>
</body>
</html>
